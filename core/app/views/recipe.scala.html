@(viewModel: models.RecipeViewModel )

<!DOCTYPE html>

<html lang="en">
    <head>
        <title>Open-eval</title>
        <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/main.css")">
        <link rel="shortcut icon" type="image/png" href="@routes.Assets.versioned("images/favicon.png")">
        <link rel="stylesheet" media="screen" href="@routes.WebJarAssets.at(WebJarAssets.locate("bootstrap.min.css"))">
        <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <style>
        .axis path,
        .axis line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
        }

        .line {
          fill: none;
          stroke: steelblue;
          stroke-width: 1.5px;
        }

        .datapoint:hover{
          fill: steelblue;
        }

        .infobox {
         box-shadow:#333333 0px 0px 10px;
         margin:200px auto;
         padding:5px 10px;
         background:rgba(35, 35, 35, 0.8);
         color: white;
         position:absolute;
         top:0px;
         left:0px;
         z-index:10500;
         font-weight:bold;
         padding: 8px;
         }
        </style>
    </head>
    <body class="body">
        <h1><a href="/">Open-Eval</a></h1>
        <p>
          @defining(viewModel.configuration){conf =>
            @conf.description
          }
        </p>
        <a href = "/addRun?conf=@viewModel.configuration.configuration_id" class="btn btn-default">
          New run of configuration
        </a>
        <div style="display:none">
        <h1 width="400px" height="400px">
        GRAPH
        </h1>
        </div>
        <div id="graph" class="graph"></div>
        @for(record <- viewModel.configuration.records) {
          <hr>
          <a href = "record?record_id=@record.record_id">
            Record: @record.record_id
          </a>
          <span class="score">@record.score</span>
          <div>
            <p> 
              @record.date | @record.author | <a href="@record.repo">code link</a>
            </p>
          </div>
          <p>@record.comment</p>
        }
        <form action="/deleteConfiguration" method="post">
          <input type="hidden"
           name="conf"
           value="@viewModel.configuration.configuration_id" />
          <input type="submit" 
            rel="facebox[.dangerzone]" 
            class="btn btn-danger boxed-action"
            value="Delete this configuration and all its history"
          />
        </form>
    </body>
    <script type="text/javascript">
      (function() {
        var scores = document.getElementsByClassName("score");
        for (var i = 0; i < scores.length; i++) {
          var score = scores[i];
          var value = +score.innerHTML;
          var red = 200 - (value * 0.01 * 200);
          var green = value * 0.01 * 200;
          score.style.color = "#" + Math.round(red+20).toString(16)+Math.round(green+20).toString(16)+"33";
          score.style.marginLeft = "2%";
        };
      })();
    </script>
    <script>
        $("#graph").append("<div class='infobox' style='display:none;'></div>");

        function showData(obj, date, close, id) {
          var coord = d3.mouse(obj);
          var infobox = d3.select(".infobox");
          // now we just position the infobox roughly where our mouse is
          infobox.style("left", (coord[0] + 90) + "px" );
          infobox.style("top", (coord[1] - 90) + "px");
          $(".infobox").html('<strong>Record ' + id + '</strong><br>' + date + '<br>' + close);
          $(".infobox").show();
        }
         
        function hideData() {
          $(".infobox").hide();
        }

        var margin = {top: 20, right: 20, bottom: 30, left: 50},
            width = 960 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;

        var parseDate = d3.time.format("%d-%b-%y").parse;

        var x = d3.time.scale()
            .range([0, width]);

        var y = d3.scale.linear()
            .range([height, 0]);

        var xAxis = d3.svg.axis()
            .scale(x)
            .orient("bottom");

        var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left");

        var line = d3.svg.line()
            .x(function(d) { return x(d.date); })
            .y(function(d) { return y(d.close); });

        var svg = d3.select("#graph").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var data = [
          {'date':'24-Oct-07',"close":74.14,'id':0},
          {'date':'24-Apr-08',"close":84.14,'id':1},
          {'date':'24-Apr-10',"close":81.14,'id':2},
          {'date':'24-Apr-11',"close":92.15,'id':3},
          {'date':'24-May-11',"close":87.14,'id':4}
        ]

        data.forEach(function(d) {
          d.disp = d.date;
          d.date = parseDate(d.date);
          d.close = +d.close;
        });

        function xx(e) { return x(e.date); };
        function yy(e) { return y(e.close); };

        x.domain(d3.extent(data, function(d) { return d.date; }));
        y.domain([0,100]);

        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);

        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 12)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text("Accuracy");

        svg.selectAll("circle")
            .data(data)
            .enter().append("circle")
            .attr("fill", "steelblue")
            .attr("r", 8)
            .attr("cx", xx)
            .attr("cy", yy)
            .on("mouseover", function(d) { showData(this, d.disp, d.close, d.id);})
            .on("mouseout", function(){ hideData();});

        svg.append("path")
            .datum(data)
            .attr("class", "line")
            .attr("d", line);

        </script>
</html>
